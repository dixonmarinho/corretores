generator client {
  provider = "prisma-client-js"
}

generator nestjsDto {
  provider                        = "prisma-generator-nestjs-dto"
  output                          = "../src/generated/nestjs-dto"
  createDtoPrefix                 = "Create"
  dtoSuffix                       = "Dto"
  entityPrefix                    = ""
  entitySuffix                    = ""
  exportRelationModifierClasses   = "true"
  fileNamingStyle                 = "camel"
  outputToNestJsResourceStructure = "false"
  reExport                        = "false"
  updateDtoPrefix                 = "Update"
}

datasource db {
  provider = "postgresql"
}

model agencies {
  id                    String                  @id(map: "pk_agencies") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                  String                  @unique(map: "uq_agencies_name") @db.VarChar
  crm_agency_id         Int                     @unique(map: "uq_agencies_crm_id")
  agency_settings       agency_settings[]
  audit_roulette_events audit_roulette_events[] @ignore
  notifications         notifications[]
  origins               origins[]
  profiles              profiles[]
  properties            properties[]
  ro_customized_queues  ro_customized_queues[]
  ro_duties             ro_duties[]
  rp_leads              rp_leads[]
  strategies            strategies[]
}

model agency_fallback_strategies {
  id             String     @id(map: "pk_agency_fallback_strategies") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  strategy_id    String     @db.Uuid
  fallback_order Int        @db.SmallInt
  strategies     strategies @relation(fields: [strategy_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model agency_settings {
  id         String    @id(map: "pk_agency_settings") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agency_id  String    @db.Uuid
  agencies   agencies  @relation(fields: [agency_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model audit_roulette_events {
  id          String   @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agency_id   String   @db.Uuid
  occurred_at DateTime @default(now()) @db.Timestamptz(6)
  ref_id      String   @db.Uuid
  event_type  String   @db.VarChar(15)
  json_data   Json?
  agencies    agencies @relation(fields: [agency_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([agency_id, ref_id], map: "idx_audit_agency_ref")
  @@ignore
}

model notifications {
  id                  String    @id(map: "pk_notifications") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agency_id           String    @db.Uuid
  type                String    @db.VarChar(50)
  title               String    @db.VarChar(255)
  message             String
  severity            String    @db.VarChar(20)
  is_read             Boolean   @default(false)
  related_entity_type String?   @db.VarChar(50)
  related_entity_id   String?   @db.Uuid
  read_at             DateTime? @db.Timestamptz(6)
  agencies            agencies  @relation(fields: [agency_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_notifications_agency_id")

  @@index([agency_id, is_read], map: "idx_notifications_agency_is_read")
  @@index([type, related_entity_type, related_entity_id], map: "idx_notifications_type_entity")
}

model origins {
  id                   String                 @id(map: "pk_origins") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agency_id            String                 @db.Uuid
  code                 String                 @db.VarChar
  description          String?                @db.VarChar
  agencies             agencies               @relation(fields: [agency_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_origins_agency_id")
  ro_customized_queues ro_customized_queues[]
  rp_deals             rp_deals[]

  @@unique([agency_id, code], map: "uq_origins_agency_code")
}

model profiles {
  id                                                     String                    @id(map: "pk_profiles") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agency_id                                              String                    @db.Uuid
  role_id                                                String                    @db.Uuid
  full_name                                              String?
  name                                                   String
  avatar_url                                             String?
  crm_code                                               Int                       @unique(map: "uq_profiles_crm_code")
  agencies                                               agencies                  @relation(fields: [agency_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_profiles_agency_id")
  roles                                                  roles                     @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_profiles_role_id")
  ro_customized_positions                                ro_customized_positions[]
  ro_duty_positions                                      ro_duty_positions[]
  rp_attempts                                            rp_attempts[]
  rp_deal_queues                                         rp_deal_queues[]
  rp_deals_rp_deals_crm_card_outdated_by_agentToprofiles rp_deals[]                @relation("rp_deals_crm_card_outdated_by_agentToprofiles")
  rp_deals_rp_deals_invalidated_byToprofiles             rp_deals[]                @relation("rp_deals_invalidated_byToprofiles")
  rp_deals_agents                                        rp_deals_agents[]
}

model properties {
  id                   String                 @id(map: "pk_properties") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agency_id            String                 @db.Uuid
  code                 String                 @db.VarChar
  agencies             agencies               @relation(fields: [agency_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_properties_agency_id")
  ro_customized_queues ro_customized_queues[]
  rp_deals             rp_deals[]

  @@unique([agency_id, code], map: "uq_properties_agency_code")
}

model ro_customized_positions {
  id                   String               @id(map: "pk_ro_customized_positions") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  customized_queue_id  String               @db.Uuid
  profile_id           String               @db.Uuid
  position_order       Int
  profiles             profiles             @relation(fields: [profile_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_customized_positions_profile_id")
  ro_customized_queues ro_customized_queues @relation(fields: [customized_queue_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_customized_positions_queue_id")

  @@unique([customized_queue_id, profile_id], map: "uq_ro_customized_positions_agent")
  @@unique([customized_queue_id, position_order], map: "uq_ro_customized_positions_order")
  @@index([profile_id], map: "ix_ro_customized_positions_agent")
  @@index([customized_queue_id, position_order], map: "ix_ro_customized_positions_queue_order")
}

model ro_customized_queues {
  id                      String                    @id(map: "pk_ro_customized_queues") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agency_id               String                    @db.Uuid
  property_id             String?                   @db.Uuid
  origin_id               String?                   @db.Uuid
  code                    String                    @db.VarChar
  source                  String?                   @default("CAMPAIGN_META") @db.VarChar
  description             String?                   @db.VarChar
  external_campaign_name  String?                   @db.VarChar
  ro_customized_positions ro_customized_positions[]
  agencies                agencies                  @relation(fields: [agency_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_customized_queues_agency_id")
  origins                 origins?                  @relation(fields: [origin_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_customized_queues_origin_id")
  properties              properties?               @relation(fields: [property_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_customized_queues_property_id")
  strategies              strategies[]

  @@unique([agency_id, code], map: "uq_ro_customized_queues_agency_code")
}

model ro_daily_duties {
  id              String            @id(map: "pk_ro_daily_duties") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  duty_id         String            @db.Uuid
  shift_type_id   String            @db.Uuid
  roster_date     DateTime          @db.Date
  ro_duties       ro_duties         @relation(fields: [duty_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_daily_duties_duty_id")
  ro_shift_types  ro_shift_types    @relation(fields: [shift_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_daily_duties_shift_type_id")
  ro_duty_windows ro_duty_windows[]

  @@unique([duty_id, roster_date], map: "uq_ro_daily_duties_date")
  @@index([shift_type_id], map: "ix_ro_daily_duties_shift_type")
}

model ro_duties {
  id               String             @id(map: "pk_ro_duties") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agency_id        String             @db.Uuid
  code             String             @db.VarChar
  ro_daily_duties  ro_daily_duties[]
  agencies         agencies           @relation(fields: [agency_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_duties_agency_id")
  ro_shift_types   ro_shift_types[]
  ro_shift_windows ro_shift_windows[]
  strategies       strategies[]

  @@unique([code, agency_id], map: "uq_ro_duties_code_agency")
}

model ro_duty_positions {
  id              String          @id(map: "pk_ro_duty_positions") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  duty_window_id  String          @db.Uuid
  profile_id      String          @db.Uuid
  position_order  Int
  profiles        profiles        @relation(fields: [profile_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_duty_positions_profile_id")
  ro_duty_windows ro_duty_windows @relation(fields: [duty_window_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_duty_positions_window_id")

  @@unique([duty_window_id, profile_id], map: "uq_ro_duty_positions_agent")
  @@unique([duty_window_id, position_order], map: "uq_ro_duty_positions_order")
  @@index([profile_id], map: "ix_ro_duty_positions_agent")
  @@index([duty_window_id, position_order], map: "ix_ro_duty_positions_window_order")
}

model ro_duty_windows {
  id                String              @id(map: "pk_ro_duty_windows") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  daily_duty_id     String              @db.Uuid
  shift_window_id   String              @db.Uuid
  ro_duty_positions ro_duty_positions[]
  ro_daily_duties   ro_daily_duties     @relation(fields: [daily_duty_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_duty_windows_daily_duty_id")
  ro_shift_windows  ro_shift_windows    @relation(fields: [shift_window_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_duty_windows_shift_window_id")

  @@unique([daily_duty_id, shift_window_id], map: "uq_ro_duty_windows_daily_shift")
  @@index([shift_window_id], map: "ix_ro_duty_windows_shift")
}

model ro_shift_types {
  id               String             @id(map: "pk_ro_shift_types") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  duty_id          String             @db.Uuid
  code             String             @db.VarChar
  description      String?            @db.VarChar
  ro_daily_duties  ro_daily_duties[]
  ro_duties        ro_duties          @relation(fields: [duty_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_shift_types_duty_id")
  ro_shift_windows ro_shift_windows[]

  @@unique([code, duty_id], map: "uq_ro_shift_types_code_duty")
}

model ro_shift_windows {
  id              String            @id(map: "pk_ro_shift_windows") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  duty_id         String            @db.Uuid
  shift_type_id   String            @db.Uuid
  window_seq      Int               @db.SmallInt
  time_start      DateTime          @db.Time(6)
  time_end        DateTime          @db.Time(6)
  ro_duty_windows ro_duty_windows[]
  ro_duties       ro_duties         @relation(fields: [duty_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_shift_windows_duty_id")
  ro_shift_types  ro_shift_types    @relation(fields: [shift_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ro_shift_windows_shift_type_id")

  @@unique([duty_id, shift_type_id, window_seq], map: "uq_ro_shift_windows_duty_seq")
  @@index([time_start, time_end], map: "ix_ro_shift_windows_time_range")
}

model roles {
  id         String     @id(map: "pk_roles") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String     @unique(map: "uq_roles_name") @db.VarChar
  profiles   profiles[]
}

model rp_attempts {
  id                   String           @id(map: "pk_rp_attempts") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  deal_id              String           @db.Uuid
  profile_id           String           @db.Uuid
  strategy_id          String           @db.Uuid
  path_link            String           @unique(map: "uq_rp_attempts_path_link") @db.VarChar
  message_id           String?          @db.VarChar
  attempt_seq          Int              @db.SmallInt
  attempt_type         String?          @default("PRIMARY") @db.VarChar
  observation_redirect String?
  sent_at              DateTime?        @default(now()) @db.Timestamptz(6)
  clicked_at           DateTime?        @db.Timestamptz(6)
  expired_at           DateTime?        @db.Timestamptz(6)
  status_link          String?          @default("WAITING") @db.VarChar
  rp_deals             rp_deals         @relation(fields: [deal_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_attempts_deal_id")
  profiles             profiles         @relation(fields: [profile_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_attempts_profile_id")
  strategies           strategies       @relation(fields: [strategy_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_attempts_strategy_id")
  rp_deals_agents      rp_deals_agents?

  @@unique([deal_id, attempt_seq], map: "uq_rp_attempts_deal_seq")
  @@unique([deal_id, attempt_type], map: "uq_rp_attempts_deal_type")
}

model rp_deal_queues {
  id                                               String    @id(map: "pk_rp_deal_queues") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  deal_id                                          String    @unique(map: "uq_rp_deal_queues_deal_id") @db.Uuid
  lead_id                                          String    @db.Uuid
  reserved_profile_id                              String?   @db.Uuid
  parent_deal_id                                   String?   @db.Uuid
  queue_type                                       String    @db.VarChar
  metadata                                         Json?
  rp_deals_rp_deal_queues_deal_idTorp_deals        rp_deals  @relation("rp_deal_queues_deal_idTorp_deals", fields: [deal_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deal_queues_deal_id")
  rp_leads                                         rp_leads  @relation(fields: [lead_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deal_queues_lead_id")
  rp_deals_rp_deal_queues_parent_deal_idTorp_deals rp_deals? @relation("rp_deal_queues_parent_deal_idTorp_deals", fields: [parent_deal_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deal_queues_parent_id")
  profiles                                         profiles? @relation(fields: [reserved_profile_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deal_queues_reserved_agent")
}

model rp_deals {
  id                                                     String               @id(map: "pk_rp_deals") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  lead_id                                                String               @db.Uuid
  property_id                                            String               @db.Uuid
  origin_id                                              String               @db.Uuid
  strategy_id                                            String               @db.Uuid
  crm_card_outdated_by_agent                             String?              @db.Uuid
  invalidated_by                                         String?              @db.Uuid
  outside_hours                                          Boolean              @default(false)
  interest                                               String?              @default("BUY") @db.VarChar
  crm_card_id                                            Int
  crm_card_status                                        String?              @default("NEW") @db.VarChar
  has_manual_redirect                                    Boolean              @default(false)
  is_valid                                               Boolean              @default(true)
  invalidated_at                                         DateTime?            @db.Timestamptz(6)
  invalidation_reason                                    String?
  deal_status                                            String?              @default("IN_QUEUE") @db.VarChar
  rp_attempts                                            rp_attempts[]
  rp_deal_queues_rp_deal_queues_deal_idTorp_deals        rp_deal_queues?      @relation("rp_deal_queues_deal_idTorp_deals")
  rp_deal_queues_rp_deal_queues_parent_deal_idTorp_deals rp_deal_queues[]     @relation("rp_deal_queues_parent_deal_idTorp_deals")
  profiles_rp_deals_crm_card_outdated_by_agentToprofiles profiles?            @relation("rp_deals_crm_card_outdated_by_agentToprofiles", fields: [crm_card_outdated_by_agent], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deals_agent_outdated_id")
  profiles_rp_deals_invalidated_byToprofiles             profiles?            @relation("rp_deals_invalidated_byToprofiles", fields: [invalidated_by], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deals_invalidated_by")
  rp_leads                                               rp_leads             @relation(fields: [lead_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deals_lead_id")
  origins                                                origins              @relation(fields: [origin_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deals_origin_id")
  properties                                             properties           @relation(fields: [property_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deals_property_id")
  strategies                                             strategies           @relation(fields: [strategy_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deals_strategy_id")
  rp_deals_agents                                        rp_deals_agents?
  rp_deals_executions                                    rp_deals_executions?
}

model rp_deals_agents {
  id                   String      @id(map: "pk_rp_deals_agents") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  deal_id              String      @unique(map: "uq_rp_deals_agents_deal_id") @db.Uuid
  profile_id           String      @db.Uuid
  accepted_attempt_id  String      @unique(map: "uq_rp_deals_agents_attempt_id") @db.Uuid
  assigned_strategy_id String      @db.Uuid
  assigned_seq         Int         @db.SmallInt
  assigned_type        String?     @default("PRIMARY") @db.VarChar
  assigned_at          DateTime?   @default(now()) @db.Timestamptz(6)
  rp_attempts          rp_attempts @relation(fields: [accepted_attempt_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deals_agents_attempt_id")
  rp_deals             rp_deals    @relation(fields: [deal_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deals_agents_deal_id")
  profiles             profiles    @relation(fields: [profile_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deals_agents_profile_id")
  strategies           strategies  @relation(fields: [assigned_strategy_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deals_agents_strategy_id")
}

model rp_deals_executions {
  id              String    @id(map: "pk_rp_deals_executions") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  deal_id         String    @unique(map: "uq_rp_deals_executions_deal_id") @db.Uuid
  log             String?
  additional_info String?
  rp_deals        rp_deals  @relation(fields: [deal_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_deals_executions_deal_id")
}

model rp_leads {
  id             String           @id(map: "pk_rp_leads") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agency_id      String           @db.Uuid
  crm_lead_id    String           @db.VarChar
  name           String           @db.VarChar
  phone          String?          @db.VarChar
  email          String?          @db.VarChar
  rp_deal_queues rp_deal_queues[]
  rp_deals       rp_deals[]
  agencies       agencies         @relation(fields: [agency_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rp_leads_agency_id")

  @@unique([agency_id, crm_lead_id], map: "uq_rp_leads_agency_crm")
}

model strategies {
  id                         String                       @id(map: "pk_strategies") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agency_id                  String                       @db.Uuid
  duty_id                    String?                      @db.Uuid
  customized_queue_id        String?                      @db.Uuid
  code                       String                       @db.VarChar
  strategy_type              String                       @db.VarChar
  name                       String                       @db.VarChar
  description                String?
  is_singleton               Boolean
  fallback_enabled           Boolean?                     @default(true)
  agency_fallback_strategies agency_fallback_strategies[]
  rp_attempts                rp_attempts[]
  rp_deals                   rp_deals[]
  rp_deals_agents            rp_deals_agents[]
  agencies                   agencies                     @relation(fields: [agency_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_strategies_agency_id")
  ro_duties                  ro_duties?                   @relation(fields: [duty_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_strategies_duty_id")
  ro_customized_queues       ro_customized_queues?        @relation(fields: [customized_queue_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_strategies_queue_id")

  @@unique([agency_id, code], map: "uq_strategies_agency_code")
}
